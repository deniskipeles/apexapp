<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/src/styles.css" />
  <title>ApexApp</title>
  <script type="module" src="/src/main.ts" defer></script>
</head>

<body>
  <div class="app-container">

    <!-- TOP NAVIGATION BAR -->
    <header class="navbar">
      <div class="brand">
        <img id="app-logo" src="/src/assets/apex.svg" onerror="this.src='/src/assets/apex.svg'" alt="Logo">
        <span id="app-name">ApexApp</span>
      </div>

      <div class="nav-links">
        <!-- Default View -->
        <button id="nav-app" class="nav-btn active">App</button>
        <button id="nav-dash" class="nav-btn">Dashboard</button>
        <!-- New Settings Button -->
        <button id="nav-settings" class="nav-btn">Settings</button>

        <button id="btn-refresh" class="nav-btn refresh-btn" title="Refresh Current View">
          &#x21bb;
        </button>
      </div>

      <div class="server-controls">
        <label
          style="display: flex; align-items: center; gap: 5px; font-size: 0.8rem; cursor: pointer; margin-right: 15px; user-select: none;">
          <input type="checkbox" id="window-mode-toggle">
          <span style="color: #555;">New Window Mode</span>
        </label>

        <div style="display: flex; align-items: center; gap: 5px;">
          <span id="status-dot" class="status-indicator"></span>
          <span id="status-text">Stopped</span>
        </div>
        <button id="server-btn" class="btn-primary">Start Server</button>
      </div>
    </header>

    <!-- MAIN CONTENT AREA -->
    <main class="content-area">

      <!-- VIEW 1: APP (Root /) - DEFAULT -->
      <div id="view-app" class="view active">
        <div class="iframe-container">
          <div id="loader-app" class="loading-overlay">
            <img src="/src/assets/tauri.svg" class="loading-logo" alt="Loading...">
            <h3>Loading App...</h3>
            <p>Waiting for server connection...</p>
          </div>
          <iframe id="frame-app" src="about:blank"></iframe>
        </div>
      </div>

      <!-- VIEW 2: DASHBOARD (/_dashboard) -->
      <div id="view-dash" class="view">
        <div class="iframe-container">
          <div id="loader-dash" class="loading-overlay">
            <img src="/src/assets/tauri.svg" class="loading-logo" alt="Loading...">
            <h3>Loading Dashboard...</h3>
            <p>Waiting for server connection...</p>
          </div>
          <iframe id="frame-dash" src="about:blank"></iframe>
        </div>
      </div>

      <!-- VIEW 3: SETTINGS (Replaces Home) -->
      <div id="view-settings" class="view  view-settings-page">
        <div class="settings-container">

          <!-- Global Sharing Card -->
          <section class="settings-card">
            <h2>üåç Global Sharing (Cloudflare Tunnel)</h2>
            <p>Expose your local ApexApp to the internet securely. Ideal for testing webhooks or sharing progress.</p>

            <div class="tunnel-box">
              <div class="tunnel-status">
                <span id="tunnel-dot" class="status-indicator"></span>
                <span id="tunnel-status-text" style="font-weight: bold; color: #64748b;">Tunnel Offline</span>
              </div>

              <button id="btn-toggle-tunnel" class="btn-primary" style="background-color: #f97316;">Start Public
                Tunnel</button>

              <div id="tunnel-url-box" style="display: none;">
                <div class="url-display">
                  <code id="tunnel-url-text">Waiting for connection...</code>
                  <div style="display: flex; gap: 5px;">
                    <button id="btn-copy-url" class="copy-btn">Copy</button>
                    <!-- New QR Button -->
                    <button id="btn-qr-url" class="copy-btn" title="Show QR Code" style="display: flex; align-items: center; justify-content: center; padding: 4px 8px;">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 7v3a2 2 0 0 1-2 2H7"/><path d="M3 12h.01"/><path d="M12 3h.01"/><path d="M12 16h.01"/><path d="M16 12h1"/><path d="M21 12v.01"/><path d="M12 21v-1"/></svg>
                    </button>
                  </div>
                </div>
                <p style="font-size: 0.8rem; margin-top: 5px; color: #ef4444;">Warning: Anyone with this link can access
                  your app.</p>
              </div>
            </div>
          </section>

          <section class="settings-card">
            <h2>üíª System Console</h2>
            <p>Live logs from ApexKit and Cloudflare processes.</p>

            <div id="console-area"
              style="background: #0f172a; color: #e2e8f0; font-family: 'Fira Code', monospace; font-size: 0.75rem; height: 250px; overflow-y: auto; padding: 15px; border-radius: 8px; border: 1px solid #1e293b; line-height: 1.4;">
              <div style="color: #64748b;">-- Console Initialized --</div>
            </div>

            <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
              <button id="btn-clear-console" class="copy-btn">Clear Console</button>
            </div>
          </section>

          <!-- Debug Info -->
          <section class="settings-card">
            <h2>üõ†Ô∏è System Tools</h2>
            <form class="row" id="greet-form" style="margin-top: 10px; display: flex; gap: 10px;">
              <input id="greet-input" placeholder="Enter a name..."
                style="padding: 8px; flex:1; border-radius: 4px; border: 1px solid #ccc;" />
              <button type="submit" class="btn-primary">Test Backend RPC</button>
            </form>
            <p id="greet-msg" style="margin-top: 10px; color: #10b981;"></p>
          </section>

        </div>
      </div>

    </main>
  </div>

  <!-- New QR Modal Structure (Add to the bottom of <body>) -->
<div id="qr-modal" style="display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(4px); z-index: 2000; align-items: center; justify-content: center; padding: 20px;">
  <div style="background: white; padding: 30px; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); text-align: center; max-width: 400px; width: 100%; position: relative;" class="animate-in zoom-in duration-300">
    <button id="btn-close-qr" style="position: absolute; top: 15px; right: 15px; border: none; background: #f1f5f9; color: #64748b; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold;">‚úï</button>
    
    <h3 style="margin: 0 0 10px 0; color: #1e293b; font-size: 1.2rem;">Scan to Access</h3>
    <p style="margin: 0 0 25px 0; color: #64748b; font-size: 0.85rem;">Point your phone camera at the code below to open the public URL.</p>
    
    <div id="qr-code-container" style="background: #f8fafc; padding: 20px; border-radius: 16px; display: flex; justify-content: center; border: 1px solid #e2e8f0; margin-bottom: 20px;">
      <!-- Canvas will be injected here -->
    </div>
    
    <code id="qr-url-display" style="display: block; background: #f1f5f9; padding: 8px; border-radius: 6px; font-size: 0.75rem; color: #334155; word-break: break-all; border: 1px solid #e2e8f0;"></code>
  </div>
</div>
</body>

</html>